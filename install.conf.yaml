# this script should be idempotent on a fully configured system
# run with $ sudo ~/.dotfiles./install
# dotbot configuration, used by ~/.dotfiles/install
# https://github.com/anishathalye/dotbot

- defaults:
    link:
        create: true
        relink: true
        ignore-missing: true # creates link even if destination doesn't exist yet

- clean: ['~'] # remove broken symlinks

#  - [git submodule update --init --recursive, Installing submodules] #TODO: where should we put this?

# create symlinks to dotfiles
# if the files already exists, its contents have to be moved first (?)
# ~/.foo is shorthand for ~./foo: ~/.dotfiles/foo

#TODO: move most of this to a bash/sh script? This would be less verbose and less reliant on dotbot
#TODO: move command defaults to top once it's working (currently doesn't work)
- shell:
    - 
        command: sudo apt-get install -y zsh #apt-get preferred to apt for scripts
        description: installing zsh
        quiet: true
        stderr: true
    - 
        command: export ZDOTDIR="$HOME/.config/zsh" #TODO: create this directory if it doesn't exist
        description: setting zsh as the default shell
        quiet: true
    -
        command: sudo chsh -s $(which zsh)
        quiet: true
        stderr: true
    - 
        command: git config --global user.name 'Ian Beckett'
        description: configuring git
        quiet: true
    - 
        command: git config --global user.email '41558014+ianebeckett@users.noreply.github.com'
        quiet: true
    - 
        command: git config --global init.defaultBranch main
        quiet: true
    -
        command: git config --global diff.colorMoved zebra
        quiet: true

#TODO: fix automated font setup
# preferred fonts: JetBrains Mono > Ubuntu Mono > Cascadia Mono > family: monospace
# confirm font installed correctly by running fc-list | grep "<name-of-font>"
  # - command: fc-cache -fv # build font #TODO: use -E, check retval and print on error?
  #   stdout: false
  #   stderr: true
  #- 
  #  command: ./test.zsh # run test script #TODO: must scripts be compatible with the system's default shell, or does shebang zsh work?
  #  stdout: true
  #  stderr: true
#  - 
#   command: ssh-keygen -t ed25519 -C ian@$(cat /etc/hostname) #TODO: should this comment be based on my git email, or my hostname? 
#    description: "generating ssh key. See add-ssh-key.txt for instructions."
#    quiet: true
#    stdout: true
#    stderr: true

# problem: I want to keep my zshenv, zshrc, and some other config files in git via ~/.dotfiles,
# I want zshenv and zshrc to remain in $HOME, because it's easy to source them from there.
# I also want them to exist in $ZDOTDIR
# Finally, I want them to symlink to ~/.dotfiles, so I can track changes to them with git
- link:
    ~/.gitconfig:
    ~/.dircolors:
    ~./zshenv:
    ~./zshrc:
    $ZDOTDIR/.zshenv:
    $ZDOTDIR/.zshrc:
    $ZDOTDIR/history: $XDG_CACHE_HOME/zsh/zcompdump-$ZSH_VERSION #TODO: fix; $ expansion not working
