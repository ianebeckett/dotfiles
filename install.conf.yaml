# dotbot configuration, used by ~/.dotfiles/install
# https://github.com/anishathalye/dotbot

#TODO: configure defaults
- defaults:
    link:
      relink: false # replaces pre-existing link

# remove broken symlinks
- clean: ['~']

#TODO: handle "Commands within a task do not have a defined ordering".
#TODO: move most of this to a bash/sh script? This would be less verbose and less reliant on dotbot
#TODO: quiet commands with descriptions
- shell:
  - command: sudo apt-get install -y zsh
    description: installing zsh
    stdout: true
    stderr: true
  - command: chsh -s $(which zsh) #TODO: which vs command -v ?
    stdout: true
    stderr: true
  - command: ssh-keygen -t ed25519 -C ian@$(cat /etc/hostname) #TODO: should this comment be based on my git email, or my hostname?

#  - [git submodule update --init --recursive, Installing submodules]

#TODO: fix automated font setup
# preferred fonts: JetBrains Mono > Ubuntu Mono > Cascadia Mono > family: monospace
# confirm font installed correctly by running fc-list | grep "<name-of-font>"
  # - command: fc-cache -fv # build font #TODO: use -E, check retval and print on error?
  #   stdout: false
  #   stderr: true
  #- 
  #  command: ./test.zsh # run test script
  #  stdout: true
  #  stderr: true

# create symlinks to dotfiles
# if the files already exists, its contents have to be moved first
#TODO: specify dotbot arguments for link
#TODO: enable linking, even if local file already exists, without breaking things
# ~/.foo is shorthand for
# ~./foo: ~/.dotfiles/foo
- link:
    ~/.zshrc:
    ~/.zshenv:
    ~/.zsh_history:
    ~/.gitconfig:
    ~/.dircolors:
    ~/.local:

- shell:
  - command: git config --global user.name 'Ian Beckett'
  - command: git config --global user.email '41558014+ianebeckett@users.noreply.github.com'
  # separated out to minimize scope of -rf flags
  #TODO: transfer this data to zsh before deleting?
  #TODO: does bash recreate these before switching to zsh?
  - command: rm ~/.bash_history
  - command: rm -r ~/.bash_sessions #TODO: test that this works without -f
  - command: source ~/.zshrc
    - description: dotbot complete. Starting a new shell with ~/.zshrc
